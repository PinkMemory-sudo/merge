# MQ



**RabbitMQ 如何保证消息不丢失**

RabbitMQ一般情况很少丢失，但是不能排除意外，为了保证我们自己系统高可用，我们必须作出更好完善措施，保证系统的稳定性。

1. 消息持久化
2. ACK确认机制
3. 设置集群镜像模式
4. 消息补偿机制
5. 消息入库：顾名思义就是将要发送的消息保存到数据库中。
6. 事务消息机制:由于会严重降低性能，所以一般不采用这种方法
7. confirm消息确认机制



**消息队列MQ怎么保证数据不重复**

程序汪推荐利用数据库中的唯一键约束 特性,天然的幂等



**消息幂等**

主要就是消息重复消费了。一种情况是消费者将消息发送给MQ，MQ没有返回确认时出问题了，消费者任务MQ没有接收到消息就会重新发送，另一种情况是生产者出现问题导致没有给MQ确认，MQ中该条消息就会被其他消费者消费。

如何解决：

消费者再消费前先判断一下ID(MQ内部会给每条消息生成一个id)，再决定是否消费。

监控，报警，补偿

