**分布式事务：**

分布式事务指事务的操作位于不同的节点上，需要保证事务的 AICD 特性



# 解决方案：



## 两阶段提交（2PC）

先看一下事务能不能都成功，都能成功后再提交。

通过引入协调者（Coordinator）来协调参与者的行为，最终决定这些参与者是要提交事务还是回滚事务。

**流程：**

1. 协调者询问参与者事务是否执行成功，参与者发回事务执行结果。
2. 如果事务在每个参与者上都执行成功，事务协调者发送通知让参与者提交事务；否则，协调者发送通知让参与者回滚事务。

**存在的问题：**

1.  同步阻塞 所有事务参与者在等待其它参与者响应的时候都处于同步阻塞状态，无法进行其它操作。
2. 单点问题 协调者在 2PC 中起到非常大的作用，发生故障将会造成很大影响。特别是在阶段二发生故障，所有参与者会一直等待状态，无法完成其它操作。
3. 数据不一致 在阶段二，如果协调者只发送了部分 Commit 消息，此时网络发生异常，那么只有部分参与者接收到 Commit 消息，也就是说只有部分参与者提交了事务，使得系统数据不一致。
4. 太过保守 任意一个节点失败就会导致整个事务失败，没有完善的容错机制。



## 补偿事务（TCC）

Try - Confirm - Cancel

针对每个操作，对于每一个操作你都需要定义三个动作分别对应`Try - Confirm - Cancel`。都要注册一个与其对应的确认和补偿（撤销）操作





优点：

缺点：



## 本地消息表（异步确认）

本地消息表与业务数据表处于同一个数据库中，这样就能利用本地事务来保证在对这两个表的操作满足事务特性，并且使用了消息队列来保证最终一致性。确保了消息的**最终一致性**





## MQ事务消息



























